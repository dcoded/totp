<!doctype html>
<html>
<head>
	<script type="text/javascript" src="js/jsSHA.js"></script>
	<script type="text/javascript" src="js/totp.js"></script>
	<style type="text/css">
		body { margin: 0 auto; font: 1em sans-serif;}
		.wrapper { width:800px; margin:0 auto; text-align: center; padding: 5em 0; }
		input { padding:10px; font-size:4em; }
		#val  { font-size:8em; font-weight: bold; width:100%; margin:1em auto;}
		#btn { font-size: 4em; width:100%; padding: 10px; border:0; background: #EEE; }
		#tmr { height:15px; }
		#bg { background-color: #eee; }
	</style>
</head>
<body>
	<div class="wrapper">
		<div>
			<input type="password" id="secret" placeholder="Secret" value="">
			<button id="btn">Generate</button>
		</div>
		<div id="val"></div>
		<div id="bg">
			<div id="tmr"></div>
		</div>
	</div>


<script type="text/javascript">
	const e = document.querySelector;
	const txt = e('#secret')
	const btn = e('#btn')
	const val = e('#val')
	const tmr = e('#tmr')
	
	const totpObj = new TOTP();
	
	let secret = ''
	btn.onclick = function()
	{
		secret = txt.value
		txt.parentNode.removeChild(txt)
		btn.parentNode.removeChild(btn)
	}

	setInterval(function() {
		if (secret != '') {
			let otp = totpObj.getOTP(secret);
			val.innerText = otp.substring(0, 3) + ' ' + otp.substring(3, 6);
			let now = new Date().getTime() / 1000 % 30;
			let exp = Math.round(now / 30 * 100);
			tmr.style.width = exp + '%';
			if (exp > 2400/30) tmr.style.backgroundColor = 'red';
			else               tmr.style.backgroundColor = 'black';
		}
	}, 1000);
</script>
</body>
</html>
