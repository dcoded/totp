<!doctype html>
<html>
<head>
	
	<script type="text/javascript" src="js/jsSHA.js"></script>
	<script type="text/javascript" src="js/totp.js"></script>
	<link rel="stylesheet" href="tailwind.min.css" />
	<style type="text/css">
		body { margin: 0 auto; font: 1em sans-serif;}
		input { padding:10px; font-size:4em; }
		#val  { font-size:8em; font-weight: bold; width:100%; margin:1em auto;}
		#btn { font-size: 4em; width:100%; padding: 10px; border:0; background: #EEE; }
		#tmr { height:15px; }
		#bg { background-color: #eee; }
	</style>
</head>
<body>
	<div class="container mx-auto px-4">
	<form>
		<div><input type="password" id="secret" placeholder="Secret" value=""></div>
		<button id="btn">Generate</button>
	</form>
		
	<div class="w-full max-w-xs">
	  <form class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
	    <div class="mb-6">
	      <label class="block text-gray-700 text-sm font-bold mb-2" for="password">
		Secret
	      </label>
	      <input type="password" placeholder="Secret" id="secret" class="shadow appearance-none border border-red-500 rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline">
	      <p class="text-red-500 text-xs italic">Please choose a password.</p>
	    </div>
	    <div class="flex items-center justify-between">
	      <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">
		Generate
	      </button>
	    </div>
	  </form>
	</div>
		
		<div id="val"></div>
		<div id="bg">
			<div id="tmr"></div>
		</div>
	</div>


<script type="text/javascript">
	const e = function(a) { return document.querySelector(a); };
	const txt = e('#secret')
	const btn = e('#btn')
	const val = e('#val')
	const tmr = e('#tmr')
	
	const totpObj = new TOTP();
	
	let secret = ''
	btn.onclick = function()
	{
		secret = txt.value
		txt.parentNode.removeChild(txt)
		btn.parentNode.removeChild(btn)
	}

	setInterval(function() {
		if (secret != '') {
			let otp = totpObj.getOTP(secret);
			val.innerText = otp.substring(0, 3) + ' ' + otp.substring(3, 6);
			let now = new Date().getTime() / 1000 % 30;
			let exp = Math.round(now / 30 * 100);
			tmr.style.width = exp + '%';
			if (exp > 2400/30) tmr.style.backgroundColor = 'red';
			else               tmr.style.backgroundColor = 'black';
		}
	}, 1000);
</script>
</body>
</html>
